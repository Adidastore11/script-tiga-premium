#!/bin/bash

# URL file IP dari GitHub
GH_URL="https://raw.githubusercontent.com/Andyyuda/izin/main/ip"

# Ambil daftar dari GitHub
USER_DATA=$(curl -s "$GH_URL")

# Definisi warna ANSI
BLUE="\033[34m"    # Biru untuk garis tabel
GREEN="\033[32m"   # Hijau untuk status ONLINE
RED="\033[31m"     # Merah untuk status OFFLINE
CYAN="\033[36m"    # Cyan untuk header
RESET="\033[0m"    # Reset warna

# Garis atas tabel
echo -e "${BLUE}┌──────────────────┬───────┬───────────┬────────────────────┬──────────┐"
echo -e "│ ${CYAN}Nama VPS         ${BLUE}│ ${CYAN}Sisa  ${BLUE}│ ${CYAN}Status SC ${BLUE}│ ${CYAN}IP Address        ${BLUE}│ ${CYAN}Status   ${BLUE}│"
echo -e "├──────────────────┼───────┼───────────┼────────────────────┼──────────┤${RESET}"

# Inisialisasi counter online dan offline
online_count=0
offline_count=0

# Loop untuk mengecek setiap user
while IFS=' ' read -r hash username expired ip; do
    if [[ "$hash" == "###" && -n "$username" && -n "$expired" && -n "$ip" ]]; then
        # Hitung sisa hari
        exp_date=$(date -d "$expired" +%s 2>/dev/null)
        today=$(date +%s)
        if [[ -n "$exp_date" && "$exp_date" -gt "$today" ]]; then
            days_left=$(( (exp_date - today) / 86400 ))
        else
            days_left="0"
        fi

        # Cek status VPS (online/offline)
        if ping -c 1 -W 1 "$ip" &> /dev/null; then
            status="${GREEN}ONLINE${RESET}"
            ((online_count++))
        else
            status="${RED}OFFLINE${RESET}"
            ((offline_count++))
        fi

        # Print hasil dengan warna
        echo -e "${BLUE}│${RESET} $(printf '%-16s' "$username") ${BLUE}│${RESET} $(printf '%-5s' "$days_left") ${BLUE}│${RESET} Aktif     ${BLUE}│${RESET} $(printf '%-18s' "$ip") ${BLUE}│${RESET} $status ${BLUE}│${RESET}"
    fi
done <<< "$USER_DATA"

# Garis bawah tabel
echo -e "${BLUE}└──────────────────┴───────┴───────────┴────────────────────┴──────────┘${RESET}"

# Tampilkan jumlah IP ONLINE dan OFFLINE dengan warna yang benar
echo -e "\nJumlah IP ONLINE: ${GREEN}$online_count${RESET}"
echo -e "Jumlah IP OFFLINE: ${RED}$offline_count${RESET}"